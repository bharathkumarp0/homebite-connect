<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>HomeBite Connect | Profile</title>

  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">

  <style>
    :root {
      --green: #4caf50;
      --blue: #4d96ff;
      --light: #f5fff7;
      --dark: #1e1e1e;
      --radius: 22px;
    }

    body {
      font-family: "Poppins", sans-serif;
      margin: 0;
      background: var(--light);
      color: var(--dark);
      overflow-x: hidden;
      animation: fadeInBody 0.9s ease-in-out;
    }

    @keyframes fadeInBody {
      from { opacity: 0; transform: translateY(15px); }
      to { opacity: 1; transform: translateY(0); }
    }

    /* HEADER */
    header {
      background: linear-gradient(135deg, var(--blue), var(--green));
      color: white;
      padding: 18px 40px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      position: sticky;
      top: 0;
      z-index: 999;
      box-shadow: 0 4px 10px rgba(0,0,0,0.2);
    }

    .brand {
      display: flex;
      align-items: center;
      gap: 12px;
      animation: slideDown 1s ease;
    }

    .brand img {
      height: 45px;
      border-radius: 50%;
      animation: pulseLogo 2s infinite alternate;
    }

    @keyframes pulseLogo {
      0% { transform: scale(1); }
      100% { transform: scale(1.08); }
    }

    .brand h1 {
      font-size: 22px;
      font-weight: 700;
    }

    nav a {
      color: white;
      text-decoration: none;
      margin-left: 20px;
      font-weight: 500;
      transition: all 0.3s ease;
    }

    nav a:hover {
      text-shadow: 0 0 10px white;
      transform: translateY(-2px);
    }

    /* PROFILE SECTION */
    .profile-section {
      max-width: 850px;
      margin: 60px auto;
      background: white;
      border-radius: var(--radius);
      box-shadow: 0 10px 30px rgba(0,0,0,0.1);
      padding: 40px;
      text-align: center;
      animation: fadeIn 1s ease;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: scale(0.95); }
      to { opacity: 1; transform: scale(1); }
    }

    .profile-pic-container {
      position: relative;
      margin: 0 auto 20px;
      width: 140px;
      height: 140px;
      border-radius: 50%;
      overflow: hidden;
      border: 4px solid var(--blue);
      box-shadow: 0 6px 18px rgba(0,0,0,0.1);
      transition: transform 0.3s ease;
    }

    .profile-pic-container:hover {
      transform: scale(1.05);
    }

    .profile-pic-container img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .edit-icon {
      position: absolute;
      bottom: 8px;
      right: 8px;
      background: var(--green);
      color: white;
      font-size: 13px;
      padding: 6px;
      border-radius: 50%;
      cursor: pointer;
      transition: 0.3s;
    }

    .edit-icon:hover {
      background: var(--blue);
      transform: scale(1.1);
    }

    .profile-info h2 {
      margin: 10px 0 5px;
      color: var(--green);
      font-size: 26px;
      font-weight: 700;
    }

    .profile-info p {
      margin: 0;
      color: #555;
      font-size: 15px;
    }

    .edit-btn {
      margin-top: 15px;
      padding: 10px 22px;
      border: none;
      border-radius: 30px;
      background: linear-gradient(90deg, var(--blue), var(--green));
      color: white;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .edit-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 10px rgba(0,0,0,0.2);
    }

    /* STATS */
    .stats {
      display: flex;
      justify-content: center;
      gap: 40px;
      margin: 30px 0;
      flex-wrap: wrap;
    }

    .stat {
      background: linear-gradient(120deg, #e6f5e9, #e8f0ff);
      padding: 15px 25px;
      border-radius: 15px;
      transition: all 0.3s ease;
    }

    .stat:hover {
      transform: translateY(-4px);
      box-shadow: 0 8px 20px rgba(0,0,0,0.15);
    }

    .stat h3 {
      color: var(--blue);
      font-size: 22px;
      margin: 0;
    }

    .stat p {
      margin: 0;
      font-weight: 500;
      color: #444;
    }

    /* TABS */
    .tabs {
      display: flex;
      justify-content: center;
      gap: 18px;
      margin-top: 25px;
    }

    .tab {
      background: #f3f3f3;
      padding: 10px 20px;
      border-radius: 30px;
      cursor: pointer;
      font-weight: 600;
      transition: all 0.3s ease;
    }

    .tab.active,
    .tab:hover {
      background: linear-gradient(90deg, var(--green), var(--blue));
      color: white;
      transform: translateY(-3px);
    }

    /* GRID */
    .grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(230px, 1fr));
      gap: 20px;
      margin-top: 25px;
      animation: fadeInGrid 1s ease;
    }

    @keyframes fadeInGrid {
      from { opacity: 0; transform: translateY(30px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .card {
      background: white;
      border-radius: 15px;
      box-shadow: 0 6px 15px rgba(0,0,0,0.1);
      overflow: hidden;
      transition: all 0.3s ease;
    }

    .card:hover {
      transform: translateY(-6px);
      box-shadow: 0 10px 25px rgba(0,0,0,0.2);
    }

    .card img {
      width: 100%;
      height: 140px;
      object-fit: cover;
    }

    .card h4 {
      padding: 12px;
      font-size: 16px;
      color: #333;
      margin: 0;
    }

    /* EDIT POPUP */
    .edit-popup {
      display: none;
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: #fff;
      padding: 25px;
      border-radius: 15px;
      box-shadow: 0 8px 25px rgba(0,0,0,0.25);
      z-index: 1000;
      width: 320px;
      animation: popIn 0.4s ease;
    }

    @keyframes popIn {
      from { opacity: 0; transform: translate(-50%, -55%) scale(0.9); }
      to { opacity: 1; transform: translate(-50%, -50%) scale(1); }
    }

    .edit-popup input, .edit-popup textarea {
      width: 100%;
      padding: 8px;
      margin: 8px 0;
      border: 1px solid #ccc;
      border-radius: 8px;
    }

    .popup-actions {
      display: flex;
      justify-content: space-between;
      margin-top: 10px;
    }

    .popup-btn {
      padding: 8px 16px;
      border: none;
      border-radius: 20px;
      cursor: pointer;
      font-weight: 600;
      transition: 0.3s;
    }

    .popup-btn.save { background: var(--green); color: #fff; }
    .popup-btn.cancel { background: #ddd; }
    .popup-btn:hover { opacity: 0.8; }

    footer {
      text-align: center;
      padding: 18px;
      margin-top: 60px;
      background: #e8ffe8;
      font-size: 14px;
      color: #333;
    }
  </style>
</head>
<body>

<header>
  <div class="brand">
    <img th:src="@{/images/logo (3).png}" alt="Logo">
    <h1>HomeBite Connect</h1>
  </div>
  <nav>
    <a th:href="@{/Frontpage}">Home</a>
    <a th:href="@{/ShareFood}">Share</a>
    <a th:href="@{/Orders}">Orders</a>
    <a th:href="@{/Swap}">Swap</a>
    <a th:href="@{/logout}">Logout</a>
  </nav>
</header>

<section class="profile-section">
  <div class="profile-pic-container">
    <img id="profileImage" th:src="@{'/profileImage/' + ${user.id}}"
         src="https://via.placeholder.com/150" alt="Profile Picture" />
    <div class="edit-icon" onclick="document.getElementById('imageUploadInput').click()">‚úé</div>
    <input type="file" id="imageUploadInput" accept="image/*" style="display:none" onchange="uploadProfileImage(event)" />
  </div>


  <div class="profile-info">
    <h2 th:text="${user.name}">John Doe</h2>
    <p th:text="${user.email}">john@example.com</p>
  </div>

  <button class="edit-btn" onclick="openEditPopup()">Edit Profile</button>

  <div class="stats">
    <div class="stat"><h3>12</h3><p>Dishes Shared</p></div>
    <div class="stat"><h3>8</h3><p>Swaps</p></div>
    <div class="stat"><h3>1.4k</h3><p>Followers</p></div>
  </div>

  <div class="tabs">
    <div class="tab active" onclick="showTab('dishes')">My Dishes</div>
    <div class="tab" onclick="showTab('favorites')">Favorites</div>
    <div class="tab" onclick="showTab('achievements')">Achievements</div>
  </div>

  <div class="grid" id="dishes">
    <div class="card">
      <img th:src="@{/images/paneer-butter.webp}" alt="Paneer Curry" />
      <h4>Paneer Curry</h4>
    </div>
    <div class="card">
      <img th:src="@{/images/pizza.webp}" alt="Homemade Pizza" />
      <h4>Homemade Pizza</h4>
    </div>
    <div class="card">
      <img th:src="@{/images/thali.avif}" alt="South Indian Thali" />
      <h4>South Indian Thali</h4>
    </div>
  </div>

  <div class="grid" id="favorites" style="display:none;">
    <div class="card">
      <img th:src="@{/images/fruit.jpeg}" alt="Fruit Smoothie" />
      <h4>Fruit Smoothie</h4>
    </div>
    <div class="card">
      <img th:src="@{/images/burger.png}" alt="Veggie Sandwich" />
      <h4>Veggie Sandwich</h4>
    </div>
  </div>

  <div class="grid" id="achievements" style="display:none;">
    <div class="card">
      <img src="https://via.placeholder.com/250x140" alt="Top Chef Badge" />
      <h4>Top Chef Badge üèÖ</h4>
    </div>
    <div class="card">
      <img src="https://via.placeholder.com/250x140" alt="100+ Likes" />
      <h4>100+ Likes üçΩÔ∏è</h4>
    </div>
  </div>

</section>

<div class="edit-popup" id="editPopup">
  <h3>Edit Profile</h3>
  <input type="text" id="editName" placeholder="Your name">
  <input type="email" id="editEmail" placeholder="Your email">
  <textarea id="editBio" placeholder="Write something about yourself..."></textarea>
  <div class="popup-actions">
    <button class="popup-btn cancel" onclick="closeEditPopup()">Cancel</button>
    <button class="popup-btn save" onclick="saveProfile()">Save</button>
  </div>
</div>

<footer>
  <p>¬© 2025 HomeBite Connect | Connecting people through homemade food ‚ù§Ô∏è</p>
</footer>

<script>
  function openEditPopup() {
  // Show popup
  document.getElementById('editPopup').style.display = 'block';

  // Prefill input fields from page
  const userName = document.querySelector('.profile-info h2').textContent;
  const userEmail = document.querySelector('.profile-info p').textContent;

  document.getElementById('editName').value = userName;
  document.getElementById('editEmail').value = userEmail;
}

function closeEditPopup() {
  document.getElementById('editPopup').style.display = 'none';
}

function saveProfile() {
  const name = document.getElementById('editName').value.trim();
  const email = document.getElementById('editEmail').value.trim();

  if (!name || !email) {
    alert('Name and Email cannot be empty.');
    return;
  }

  fetch('/updateProfile', {
    method: 'PUT',
    headers: {'Content-Type': 'application/json'},
    body: JSON.stringify({ name, email })
  })
  .then(response => response.text())
  .then(message => {
    alert(message);
    if (message.toLowerCase().includes('success')) {
      // Update profile info on page
      document.querySelector('.profile-info h2').textContent = name;
      document.querySelector('.profile-info p').textContent = email;

      closeEditPopup();
    }
  })
  .catch(() => alert('Failed to update profile.'));
}

function uploadProfileImage(event) {
  const file = event.target.files[0];
  if (!file) return;

  const formData = new FormData();
  formData.append('image', file);

  fetch('/uploadProfileImage', {
    method: 'POST',
    body: formData,
  })
  .then(response => response.json())
  .then(data => {
    if (data.imageUrl) {
      document.getElementById('profileImage').src = data.imageUrl + "?t=" + new Date().getTime();
      alert('Profile image updated successfully!');
    } else {
      alert('Failed to upload image');
    }
  })
  .catch(() => alert('Error uploading image'));
}












</script>

</body>
</html>
