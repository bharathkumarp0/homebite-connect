<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Confirm Your Order | HomeBite Connect</title>

  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600&display=swap" rel="stylesheet" />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>

  <style>
    * { box-sizing: border-box; }
    body { margin: 0; font-family: 'Poppins', sans-serif; background-color: #F0FFF4; color: #333; overflow-x: hidden; }
    .nav { display: flex; align-items: center; justify-content: space-between; padding: 10px 30px; height: 65px; background-color: #F0FFF4;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1); position: sticky; top: 0; z-index: 100; flex-wrap: wrap; }
    .nav img { height: 45px; }
    .nav h1 { font-size: 22px; color: #4CAF50; margin: 0; font-weight: 600; }
    .nav-links { display: flex; flex-wrap: wrap; gap: 15px; }
    .nav-links a { text-decoration: none; color: #333; font-weight: 500; transition: color 0.3s; font-size: 15px; }
    .nav-links a:hover { color: #4CAF50; }
    .order-container { display: flex; flex-wrap: wrap; justify-content: center; align-items: flex-start; gap: 40px; padding: 90px 40px; }
    .food-preview, .order-summary {
      flex: 1; min-width: 300px; max-width: 450px; background: #fff; border-radius: 20px;
      box-shadow: 0 4px 15px rgba(0,0,0,0.1); padding: 25px; text-align: center;
      transition: transform 0.3s ease, box-shadow 0.3s ease;
    }
    .food-preview img { width: 100%; max-width: 320px; border-radius: 18px; box-shadow: 0 8px 24px rgba(0,0,0,0.12); margin-bottom: 15px; transition: transform 0.4s; }
    .food-preview img:hover { transform: scale(1.03); }
    .food-preview h2 { font-size: 24px; color: #2E7D32; margin-bottom: 8px; }
    .food-preview p { font-size: 15px; color: #555; margin-bottom: 10px; }
    .quantity-box { display: flex; justify-content: center; align-items: center; margin: 20px 0; gap: 15px; }
    .quantity-btn { background-color: #4CAF50; color: white; border: none; padding: 10px 14px; font-size: 18px; border-radius: 8px; cursor: pointer; transition: background 0.3s; }
    .quantity-btn:hover { background-color: #388E3C; }
    .quantity-display { font-size: 18px; font-weight: 600; color: #333; }
    .order-summary h3 { text-align: center; color: #388E3C; font-size: 22px; margin-bottom: 20px; }
    .order-summary .summary-item { display: flex; justify-content: space-between; margin: 10px 0; font-size: 15px; }
    .order-summary .total { font-weight: 600; color: #2E7D32; font-size: 18px; border-top: 1px solid #ddd; padding-top: 10px; margin-top: 10px; }
    .address-form { margin-top: 25px; text-align: left; }
    .address-form label { display: block; font-size: 14px; color: #333; margin-bottom: 5px; }
    .address-form input, .address-form textarea {
      width: 100%; padding: 10px; border: 1px solid #ccc; border-radius: 10px; margin-bottom: 12px;
      font-size: 14px; font-family: 'Poppins', sans-serif; transition: border-color 0.3s;
    }
    .address-form input:focus, .address-form textarea:focus { border-color: #4CAF50; outline: none; }
    .address-form textarea { resize: none; height: 70px; }
    .confirm-btn {
      display: block; width: 100%; background: linear-gradient(90deg, #43a047, #66bb6a);
      color: white; padding: 12px 0; border: none; border-radius: 25px;
      font-size: 16px; cursor: pointer; transition: all 0.3s ease; margin-top: 20px;
    }
    .confirm-btn:hover { background: #2E7D32; transform: scale(1.05); box-shadow: 0 6px 20px rgba(67,160,71,0.25); }
    footer { text-align: center; padding: 25px 20px; color: #4CAF50; border-top: 1px solid #ddd; margin-top: 50px; font-size: 14px; }
  </style>
</head>

<body>
<header>
  <div class="nav">
    <img src="/images/logo (3).png" alt="HomeBite Logo" />
    <h1>HomeBite Connect</h1>
    <div class="nav-links">
      <a th:href="@{/Frontpage}">Home</a>
      <a th:href="@{/ShareFood}">Share Food</a>
      <a th:href="@{/Orders}">Orders</a>
      <a th:href="@{/Swap}">Swap</a>
      <a th:href="@{/profile}">Profile</a>
    </div>
  </div>
</header>

<main class="order-container">
  <div class="food-preview">
    <img id="foodImage" src="" alt="Food Image" />
    <h2 id="foodName">Food Name</h2>
    <p id="foodDesc">Food Description</p>
    <div class="quantity-box">
      <button class="quantity-btn" onclick="updateQuantity(-1)">−</button>
      <span class="quantity-display" id="quantity">1</span>
      <button class="quantity-btn" onclick="updateQuantity(1)">+</button>
    </div>
  </div>

  <div class="order-summary">
    <h3>Order Summary</h3>
    <div class="summary-item"><span>Dish:</span> <span id="summaryName">Food Name</span></div>
    <div class="summary-item"><span>Quantity:</span> <span id="summaryQuantity">1</span></div>
    <div class="summary-item"><span>Price (per item):</span> ₹<span id="pricePerItem">0</span></div>
    <div class="summary-item total"><span>Total:</span> ₹<span id="summaryTotal">0</span></div>

    <div class="address-form">
      <label for="name">Full Name</label>
      <input type="text" id="name" placeholder="Enter your full name" required />

      <label for="phone">Phone Number</label>
      <input type="tel" id="phone" placeholder="Enter your phone number" required />

      <label for="address">Address</label>
      <textarea id="address" placeholder="Enter full delivery address" required></textarea>

      <label for="city">City</label>
      <input type="text" id="city" placeholder="Enter city" required />

      <label for="pincode">Pincode</label>
      <input type="text" id="pincode" placeholder="Enter pincode" required />
    </div>

    <button class="confirm-btn" onclick="confirmOrder()">Confirm Order</button>
  </div>
</main>

<footer>
  <p>© 2025 HomeBite Connect | Bringing Communities Together Through Food ❤️</p>
</footer>

<script>
  document.addEventListener("DOMContentLoaded", () => {
  const urlParams = new URLSearchParams(window.location.search);
  const image = urlParams.get('image');
  const name = urlParams.get('name');
  const desc = urlParams.get('desc');
  const price = Number(urlParams.get('price')) || 0;

  if (!name) {
    alert("No food selected! Please go back and select a dish.");
    // Optionally redirect to frontpage
  } else {
    document.getElementById("foodName").textContent = decodeURIComponent(name);
    document.getElementById("foodDesc").textContent = decodeURIComponent(desc);
<!--     foodImage: document.getElementById("foodImage").src,-->
    document.getElementById("foodImage").src = decodeURIComponent(image);
    document.getElementById("pricePerItem").textContent = price.toFixed(2);
    document.getElementById("summaryTotal").textContent = price.toFixed(2);


    // Store the price for quantity calculations
    window.pricePerItem = price;
    window.quantity = 1;
  }
});

function updateQuantity(delta) {
  window.quantity = Math.max(1, window.quantity + delta);
  document.getElementById("quantity").textContent = window.quantity;
  document.getElementById("summaryQuantity").textContent = window.quantity;
  const total = (window.quantity * window.pricePerItem).toFixed(2);
  document.getElementById("summaryTotal").textContent = total;
}



function confirmOrder() {
  const name = document.getElementById("name").value.trim();
  const phone = document.getElementById("phone").value.trim();
  const address = document.getElementById("address").value.trim();
  const city = document.getElementById("city").value.trim();
  const pincode = document.getElementById("pincode").value.trim();

  if (!name || !phone || !address || !city || !pincode) {
    alert("Please fill all delivery details.");
    return;
  }
const orderData = {
    food: {
      name: document.getElementById("foodName").textContent,
      description: document.getElementById("foodDesc").textContent,
      image: document.getElementById("foodImage").src,
      foodImage: document.getElementById("foodImage").src,
      pricePerItem: window.pricePerItem,
       },
    quantity: window.quantity,
    deliveryDetails: { name, phone, address, city, pincode }
  };
localStorage.setItem("orderData", JSON.stringify(orderData));

fetch('/orders/place', {
  method: 'POST',
  headers: { 'Content-Type': 'application/json' },
  body: JSON.stringify(orderData)
});

  // Redirect to payment page
  window.location.href = "/Payment" ;
}
  async function confirmPayment() {
  const orderDataStr = localStorage.getItem("orderData");
  if (!orderDataStr) {
    alert("Order data missing!");
    return;
  }
  const orderData = JSON.parse(orderDataStr);

  try {
    const response = await fetch('/orders/place', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({
        foodName: orderData.food.name,
        foodImage: orderData.food.image,
        unitPrice: orderData.food.pricePerItem,
        quantity: orderData.quantity,
        totalPrice: orderData.food.pricePerItem * orderData.quantity,
        customerName: orderData.deliveryDetails.name,
        phone: orderData.deliveryDetails.phone,
        address: orderData.deliveryDetails.address,
        city: orderData.deliveryDetails.city,
        pincode: orderData.deliveryDetails.pincode,
        orderStatus: "Placed"
      })
    });
    if (!response.ok) throw new Error("Failed to place order");
    // continue with success flow...
  } catch (err) {
    alert("Error placing order: " + err.message);
  }
}









</script>
</body>
</html>
































































































<script>
  document.addEventListener("DOMContentLoaded", () => {
    const urlParams = new URLSearchParams(window.location.search);
    const image = urlParams.get('image');
    const name = urlParams.get('name');
    const desc = urlParams.get('desc');
    const price = Number(urlParams.get('price')) || 0;

    if (!name) {
      alert("No food selected! Please go back and select a dish.");
      return;
    }

    document.getElementById("foodName").textContent = decodeURIComponent(name);
    document.getElementById("foodDesc").textContent = decodeURIComponent(desc);
    document.getElementById("foodImage").src = decodeURIComponent(image);
    document.getElementById("pricePerItem").textContent = price.toFixed(2);
    document.getElementById("summaryTotal").textContent = price.toFixed(2);

    window.pricePerItem = price;
    window.quantity = 1;
  });

  function updateQuantity(delta) {
    window.quantity = Math.max(1, window.quantity + delta);
    document.getElementById("quantity").textContent = window.quantity;
    document.getElementById("summaryQuantity").textContent = window.quantity;
    const total = (window.quantity * window.pricePerItem).toFixed(2);
    document.getElementById("summaryTotal").textContent = total;
  }

  function confirmOrder() {
    const name = document.getElementById("name").value.trim();
    const phone = document.getElementById("phone").value.trim();
    const address = document.getElementById("address").value.trim();
    const city = document.getElementById("city").value.trim();
    const pincode = document.getElementById("pincode").value.trim();

    if (!name || !phone || !address || !city || !pincode) {
      alert("Please fill all delivery details.");
      return;
    }

    const orderData = {
      food: {
        name: document.getElementById("foodName").textContent,
        description: document.getElementById("foodDesc").textContent,
        image: document.getElementById("foodImage").src,
        foodImage: document.getElementById("foodImage").src,
        pricePerItem: window.pricePerItem,
      },
      quantity: window.quantity,
      deliveryDetails: { name, phone, address, city, pincode }
    };

    localStorage.setItem("orderData", JSON.stringify(orderData));

    fetch('/orders/place', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({
        foodName: orderData.food.name,
        foodImage: orderData.food.image,
        unitPrice: orderData.food.pricePerItem,
        quantity: orderData.quantity,
        totalPrice: orderData.food.pricePerItem * orderData.quantity,
        customerName: orderData.deliveryDetails.name,
        phone: orderData.deliveryDetails.phone,
        address: orderData.deliveryDetails.address,
        city: orderData.deliveryDetails.city,
        pincode: orderData.deliveryDetails.pincode,
        orderStatus: "Placed"
      })
    })
    .then(res => {
      if (!res.ok) throw new Error("Failed to place order");
      window.location.href = "/Payment";
    })
    .catch(err => alert("Error placing order: " + err.message));
  }
</script>



