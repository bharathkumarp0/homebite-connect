<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>My Shared Dishes | HomeBite Connect</title>

    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&family=Titan+One&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/gsap.min.js"></script>

    <style>
        :root {
          --green:#5BC85B; --blue:#4D96FF; --text:#263238;
          --radius:18px; --shadow:0 10px 30px rgba(0,0,0,0.09);
        }
        * { box-sizing:border-box; margin:0; padding:0; }
        body {
          font-family:'Poppins',sans-serif;
          background:linear-gradient(135deg,#E6F4EA,#FFFFFF 60%,#E3F2FD);
          color:var(--text); min-height:100vh; overflow-x:hidden;
        }
        header {
          display:flex; justify-content:space-between; align-items:center;
          padding:18px 40px; background:rgba(255,255,255,0.92);
          backdrop-filter:blur(6px); box-shadow:var(--shadow);
          position:sticky; top:0; z-index:60;
        }
        .logo {
          font-family:'Titan One',cursive; font-size:30px;
          background:linear-gradient(90deg,var(--green),var(--blue));
          -webkit-background-clip:text; -webkit-text-fill-color:transparent;
        }
        nav a {
          margin-left:20px; text-decoration:none; color:var(--text);
          font-weight:600; transition:.18s;
        }
        nav a:hover { color:var(--blue); }
        .header-section { text-align:center; padding:56px 18px 18px; }
        .header-section h1 {
          font-family:'Titan One'; font-size:44px;
          background:linear-gradient(90deg,var(--green),var(--blue));
          -webkit-background-clip:text; -webkit-text-fill-color:transparent;
        }
        .header-section p { color:#555; margin-top:8px; }
        .container {
          max-width:1200px; margin:0 auto; display:flex; flex-wrap:wrap;
          gap:28px; padding:32px; justify-content:center;
        }
        .card {
          width:340px; background:#fff; border-radius:var(--radius); overflow:hidden;
          box-shadow:var(--shadow); transition:transform .35s ease,box-shadow .35s ease;
          position:relative;
        }
        .card:hover { transform:translateY(-10px); box-shadow:0 20px 50px rgba(0,0,0,0.12); }
        .card img { width:100%; height:210px; object-fit:cover; display:block; background:#f4f4f4; }
        .card-content { padding:18px; }
        .tag {
          display:inline-block; background:var(--green); color:#fff;
          padding:6px 12px; border-radius:14px; font-weight:600;
          font-size:13px; margin-bottom:10px;
        }
        .card-content h3 { color:var(--blue); font-size:20px; margin:8px 0; }
        .card-content p { color:#555; line-height:1.5; margin:6px 0; }
        .meta { color:#444; font-weight:600; margin-top:8px; }
        .actions { display:flex; gap:12px; margin-top:14px; }
        .btn {
          flex:1; border-radius:12px; padding:10px 8px; border:none; font-weight:700; color:#fff;
          display:inline-flex; align-items:center; justify-content:center; gap:8px; cursor:pointer;
          transition:transform .15s ease;
        }
        .btn:active { transform:scale(.98); }
        .btn.edit { background:linear-gradient(90deg,var(--blue),#3aa0ff); }
        .btn.delete { background:linear-gradient(90deg,#ff6b6b,#e74c3c); }
        .no-data { text-align:center; padding:36px; color:#666; width:100%; }

        /* Modal styling */
        .modal {
          display:none; position:fixed; top:0; left:0; width:100%; height:100%;
          background:rgba(0,0,0,0.5); justify-content:center; align-items:center; z-index:999;
        }
        .modal-content {
          background:#fff; padding:24px; border-radius:var(--radius); width:360px;
          box-shadow:var(--shadow);
        }
        .modal-content h3 { margin-bottom:12px; color:var(--blue); }
        .modal-content label { display:block; margin-top:8px; font-weight:600; color:#333; }
        .modal-content input, .modal-content textarea {
          width:100%; padding:8px; border:1px solid #ccc; border-radius:8px; margin-top:4px;
        }
        .close {
          float:right; font-size:20px; cursor:pointer; color:#888;
        }
        footer {
          text-align:center; padding:28px; color:#666;
          border-top:1px solid #eee; background:rgba(255,255,255,0.6);
        }
        @media(max-width:760px){ .container{padding:18px;gap:18px} .card{width:94vw} }
    </style>
</head>
<body>

<header>
    <div class="logo">HomeBite Connect</div>
    <nav>
        <a th:href="@{/Frontpage}">Home</a>
        <a th:href="@{/ShareFood}">Share Food</a>
        <a th:href="@{/Profile}">Profile</a>
    </nav>
</header>

<section class="header-section">
    <h1>My Shared Dishes üç¥</h1>
    <p>Manage, edit, or track your shared meals in style</p>
</section>

<main class="container">
    <div th:if="${sharedFoods == null or #lists.isEmpty(sharedFoods)}" class="no-data">
        <h3>No dishes shared yet üçΩÔ∏è</h3>
        <p>Share your first meal to see it appear here.</p>
    </div>

    <div th:each="food : ${sharedFoods}" class="card">
        <img th:src="@{'/myshare/' + ${food.imageUrl}}"
             th:alt="${food.dishName}"
             onerror="this.src='https://via.placeholder.com/340x210?text=No+Image';" />


        <div class="card-content">
            <div class="tag" th:text="${food.category}">Category</div>
            <h3 th:text="${food.dishName}">Dish Name</h3>
            <p th:text="${food.description}">Description</p>

            <div class="meta">
                <div><strong>Location:</strong> <span th:text="${food.location}">-</span></div>
                <div style="margin-top:6px"><strong>Date:</strong> <span th:text="${#temporals.format(food.postedAt,'dd-MM-yyyy HH:mm')}">--</span></div>
            </div>

            <div class="actions">
                <form th:action="@{/deleteShare/{id}(id=${food.id})}" method="get" style="flex:1">
                    <button type="submit" class="btn delete">üóë Delete</button>
                </form>

                <button type="button" class="btn edit"
                        th:data-id="${food.id}"
                        th:data-dish="${food.dishName}"
                        th:data-desc="${food.description}"
                        th:data-cat="${food.category}"
                        th:data-loc="${food.location}"
                        th:data-img="${food.imageUrl}"
                        onclick="openEditModal(this)">
                    ‚úè Edit
                </button>
            </div>
        </div>
    </div>
</main>

<!-- Edit Modal -->
<div id="editModal" class="modal">
    <div class="modal-content">
        <span class="close" onclick="closeModal()">&times;</span>
        <h3>Edit Food Share</h3>
        <form id="editForm" method="post" th:action="@{/updateShare/{id}(id=0)}">
            <input type="hidden" id="editId" name="id">
            <label>Dish Name</label>
            <input type="text" id="editDishName" name="dishName" required>
            <label>Description</label>
            <textarea id="editDescription" name="description" required></textarea>
            <label>Category</label>
            <input type="text" id="editCategory" name="category" required>
            <label>Location</label>
            <input type="text" id="editLocation" name="location" required>
            <label>Image URL</label>
            <input type="text" id="editImageUrl" name="imageUrl">
            <button type="submit" class="btn edit" style="margin-top:10px;">üíæ Save Changes</button>
        </form>
    </div>
</div>

<footer>¬© 2025 HomeBite Connect | Spreading Love Through Food ‚ù§Ô∏è</footer>

<script>
    // GSAP intro
    if(window.gsap){
      gsap.from(".header-section h1",{opacity:0,y:-30,duration:0.9});
      gsap.from(".header-section p",{opacity:0,y:8,duration:0.9,delay:0.2});
      gsap.from(".card",{opacity:0,y:30,stagger:0.18,duration:0.8,ease:"power3.out"});
    }

    // Modal logic
    function openEditModal(button) {
      const id = button.getAttribute("data-id");
      const dish = button.getAttribute("data-dish");
      const desc = button.getAttribute("data-desc");
      const cat = button.getAttribute("data-cat");
      const loc = button.getAttribute("data-loc");
      const img = button.getAttribute("data-img");

      document.getElementById("editModal").style.display = "flex";
      document.getElementById("editId").value = id;
      document.getElementById("editDishName").value = dish;
      document.getElementById("editDescription").value = desc;
      document.getElementById("editCategory").value = cat;
      document.getElementById("editLocation").value = loc;
      document.getElementById("editImageUrl").value = img;
      document.getElementById("editForm").action = "/updateShare/" + id;
    }

    function closeModal() {
      document.getElementById("editModal").style.display = "none";
    }
</script>

</body>
</html>
